# ContractPilot 보완 작업 구현 목록

## 개요
- 작업 기간: 2026-02-23
- 목적: 한국 시장 진입을 위한 기술적 장애 요인 해결
- 참조: "ContractPilot 한국 시장 진입 타당성 분석 보고서.pdf"

---

## 1. 신규 생성 파일

### Backend (Python)

| 파일 경로 | 설명 | 우선순위 |
|----------|------|---------|
| `backend/app/services/hwp_service.py` | HWP/HWPX 파일 파싱 서비스 | 1순위 |
| `backend/app/services/document_service.py` | 통합 문서 처리 서비스 | 1순위 |
| `backend/app/services/anonymizer_service.py` | 개인정보 익명화 서비스 | 2순위 |
| `backend/app/core/llm_client.py` | 다중 LLM 제공자 클라이언트 | 2순위 |
| `backend/app/services/korean_law_service.py` | 한국 법령 API 연동 서비스 | 3순위 |
| `backend/app/services/collaboration_service.py` | 협업 기능 서비스 | 3순위 |

### Frontend (TypeScript/React)

| 파일 경로 | 설명 | 우선순위 |
|----------|------|---------|
| `frontend/src/components/CollaborationPanel.tsx` | 협업 도구 패널 | 3순위 |
| `frontend/src/components/LegalReference.tsx` | 법령 정보 표시 컴포넌트 | 3순위 |

### Documentation

| 파일 경로 | 설명 |
|----------|------|
| `docs/한국시장_진입_타당성_반박자료.md` | 보고서 반박 자료 |
| `docs/보완작업_구현목록.md` | 본 문서 |

---

## 2. 수정된 파일

### Backend

| 파일 경로 | 변경 내용 |
|----------|----------|
| `backend/app/core/config.py` | LLM 제공자 설정, 익명화 설정 추가 |
| `backend/app/core/openai_client.py` | SecureLLMClient 사용으로 전환 |
| `backend/app/api/routes.py` | HWP 지원, 법령 API, 협업 API 추가 |
| `backend/app/models/schemas.py` | disclaimer, 협업/법령 스키마 추가 |
| `backend/app/services/analysis_service.py` | 통합 문서 서비스, 법령 연동, 면책 조항 |
| `backend/requirements.txt` | olefile, anthropic 패키지 추가 |
| `backend/.env.example` | 새 환경변수 문서화 |

### Frontend

| 파일 경로 | 변경 내용 |
|----------|----------|
| `frontend/src/components/FileUpload.tsx` | HWP 확장자 지원 추가 |
| `frontend/src/components/AnalysisResult.tsx` | 면책 조항, 법령, 협업 컴포넌트 통합 |
| `frontend/src/app/page.tsx` | 개인정보 보호 배지, Footer 면책 조항 |

---

## 3. 기능별 구현 상세

### 1순위: HWP 지원 + 면책 조항

#### HWP 지원
```
hwp_service.py
├── extract_text_from_hwp()     # HWP/HWPX 텍스트 추출
├── _extract_from_hwpx()        # HWPX (ZIP) 처리
├── _extract_from_hwp5()        # HWP5 (OLE) 처리
├── _decode_hwp5_section()      # HWP5 바이너리 디코딩
└── extract_text_with_ocr()     # OCR 지원 (옵션)

document_service.py
├── extract_text_from_document()  # 통합 텍스트 추출
├── validate_file()               # 파일 유효성 검사
└── is_supported_file()           # 지원 형식 확인
```

#### 면책 조항
```
적용 위치:
├── analysis_service.py    # DISCLAIMER 상수, 응답에 포함
├── schemas.py            # disclaimer 필드 추가
├── AnalysisResult.tsx    # UI 상단 면책 안내
└── page.tsx              # Footer 상세 면책 조항
```

### 2순위: 로컬 LLM + 데이터 익명화

#### 다중 LLM 클라이언트
```
llm_client.py
├── BaseLLMClient          # 추상 기본 클래스
├── OpenAIClient           # OpenAI GPT
├── UpstageClient          # Upstage Solar (한국)
├── AnthropicClient        # Anthropic Claude
├── LocalLLMClient         # Ollama/vLLM
├── LLMClientFactory       # 팩토리 패턴
└── SecureLLMClient        # 익명화 래퍼
```

#### 개인정보 익명화
```
anonymizer_service.py
├── PersonalDataAnonymizer
│   ├── _mask_resident_number()  # 주민번호
│   ├── _mask_phone()            # 전화번호
│   ├── _mask_email()            # 이메일
│   ├── _mask_business_number()  # 사업자번호
│   ├── _mask_account_number()   # 계좌번호
│   ├── _mask_address()          # 주소
│   ├── _mask_korean_name()      # 한국 이름
│   └── _mask_amount()           # 금액 (옵션)
├── anonymize_text()             # 헬퍼 함수
└── restore_text()               # 복원 함수
```

### 3순위: 법령 API + 협업 기능

#### 법령 서비스
```
korean_law_service.py
├── KoreanLawAPIClient           # 국가법령정보센터 API
├── CourtCaseSearchClient        # 대법원 판례 API
├── CONTRACT_CHECKLIST           # 계약 유형별 체크리스트
├── ESSENTIAL_LAWS               # 오프라인 법령 캐시
└── KoreanLawService
    ├── get_relevant_laws()      # 관련 법령 조회
    ├── search_similar_cases()   # 판례 검색
    ├── get_checklist()          # 체크리스트 조회
    └── check_missing_clauses()  # 누락 조항 체크
```

#### 협업 서비스
```
collaboration_service.py
├── Comment                      # 코멘트 데이터클래스
├── AnalysisVersion              # 버전 데이터클래스
├── SharedAnalysis               # 공유 분석 데이터클래스
└── CollaborationService
    ├── create_shared_analysis() # 공유 생성
    ├── add_collaborator()       # 협업자 추가
    ├── add_comment()            # 코멘트 추가
    ├── resolve_comment()        # 코멘트 해결
    ├── create_new_version()     # 버전 생성
    ├── get_version_diff()       # 버전 비교
    └── generate_share_link()    # 공유 링크 생성
```

---

## 4. 새로운 API 엔드포인트

### 시스템 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/system/llm-info` | 현재 LLM 제공자 정보 |
| POST | `/system/test-anonymization` | 익명화 테스트 |

### 법령 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/law/search` | 관련 법령 검색 |
| POST | `/law/cases` | 관련 판례 검색 |
| GET | `/law/checklist/{type}` | 계약 유형별 체크리스트 |
| POST | `/law/check-missing` | 누락 조항 체크 |

### 협업 API
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/collaboration/share` | 공유 생성 |
| GET | `/collaboration/share/{id}` | 공유 조회 |
| POST | `/collaboration/collaborator` | 협업자 추가 |
| POST | `/collaboration/comment` | 코멘트 추가 |
| POST | `/collaboration/comment/resolve` | 코멘트 해결 |
| GET | `/collaboration/comments/{id}/{clause}` | 조항별 코멘트 |
| POST | `/collaboration/version` | 버전 생성 |
| GET | `/collaboration/version/{id}/{num}` | 버전 조회 |
| GET | `/collaboration/diff/{id}/{v1}/{v2}` | 버전 비교 |
| POST | `/collaboration/share-link` | 공유 링크 생성 |

---

## 5. 환경 설정

### .env 설정 예시
```bash
# LLM 제공자 (openai/upstage/anthropic/local)
LLM_PROVIDER=upstage

# Upstage (한국 서버)
UPSTAGE_API_KEY=your-key
UPSTAGE_MODEL=solar-pro

# 개인정보 보호
ANONYMIZE_PERSONAL_DATA=true
PRESERVE_AMOUNTS_IN_ANONYMIZATION=true
```

### 패키지 설치
```bash
# Backend
pip install olefile anthropic

# Frontend (기존 유지)
npm install
```

---

## 6. 테스트 방법

### HWP 파일 업로드 테스트
```bash
curl -X POST http://localhost:8000/api/analyze \
  -F "file=@계약서.hwp"
```

### 익명화 테스트
```bash
curl -X POST http://localhost:8000/api/system/test-anonymization \
  -d "text=홍길동 010-1234-5678 서울시 강남구"
```

### 법령 검색 테스트
```bash
curl -X POST http://localhost:8000/api/law/search \
  -H "Content-Type: application/json" \
  -d '{"clause_text":"해지 조항", "contract_type":"투자계약서"}'
```

---

## 7. 향후 개선 사항

- [ ] 실제 데이터베이스 연동 (현재 인메모리)
- [ ] 실시간 WebSocket 협업
- [ ] 법령 API 캐싱 (Redis)
- [ ] 대용량 문서 청크 처리
- [ ] 한국어 특화 LLM 파인튜닝

---

*생성일: 2026-02-23*
